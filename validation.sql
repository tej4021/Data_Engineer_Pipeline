-- ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-----------------------------------------    VALIDATION

"""
Profit Calculation -> Validation
"""
-- subscription_id = 0066eba3-et5t-46c3-3t2e-3e69c5216173 *************** SAMPLE 1************************
-- CSV RAW DATA 
-- cost.csv
+------------------------------------+----------+--------+
|subscription_id                     |month     |Cost    |
+------------------------------------+----------+--------+
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-09-01|53.97184|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-10-01|34.17152|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-10-01|74.2512 | --> Picked latest cost price for profit calculation
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-11-01|54.77024|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-12-01|90.85792|
+------------------------------------+----------+--------+

-- Invoicing.csv
+------------------------------------+---------------+----------+----------+--------------------------+
|subscription_id                     |calculated_cost|start     |end       |created_at                |
+------------------------------------+---------------+----------+----------+--------------------------+
|0066eba3-et5t-46c3-3t2e-3e69c5216173|29.0           |2022-09-01|2022-09-30|2022-10-05 19:42:38.6228  |
|0066eba3-et5t-46c3-3t2e-3e69c5216173|29.0           |2022-09-01|2022-09-30|2022-11-01 19:37:01.677686|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|29.0           |2022-10-01|2022-10-31|2022-11-01 19:37:01.677686|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|29.0           |2022-11-01|2022-11-30|2022-12-18 20:54:09.209639|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|29.0           |2022-11-01|2022-11-30|2022-11-29 16:44:52.49871 |
|0066eba3-et5t-46c3-3t2e-3e69c5216173|29.0           |2022-12-01|2022-12-31|2022-12-18 20:54:09.209639|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|29.0           |2023-01-01|2023-01-31|2023-01-11 15:45:55.113256|
+------------------------------------+---------------+----------+----------+--------------------------+

-- final table 

SELECT * FROM fct_profitability WHERE subscription_id = '0066eba3-et5t-46c3-3t2e-3e69c5216173' ORDER BY month;
+------------------------------------+-------+------------+-----------+------------------+
|subscription_id                     |month  |sales_amount|cost_amount|profit            |
+------------------------------------+-------+------------+-----------+------------------+
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-09|58.0        |53.97184   |4.02816           |
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-10|29.0        |74.2512    |-45.2512          |
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-11|58.0        |54.77024   |3.229759999999999 |
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-12|29.0        |90.85792   |-61.85791999999999|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2023-01|29.0        |0.0        |29.0              |
+------------------------------------+-------+------------+-----------+------------------+

-- subscription_id = 02323929-4c3a-4b42-9et0-333fbaeec26e *************** SAMPLE 2************************
-- CSV RAW DATA 
-- cost.csv
+------------------------------------+----------+--------+
|subscription_id                     |month     |Cost    |
+------------------------------------+----------+--------+
|02323929-4c3a-4b42-9et0-333fbaeec26e|2022-09-01|39.28128|
|02323929-4c3a-4b42-9et0-333fbaeec26e|2022-10-01|31.936  |
|02323929-4c3a-4b42-9et0-333fbaeec26e|2022-10-01|52.37504|
|02323929-4c3a-4b42-9et0-333fbaeec26e|2022-11-01|69.62048|
|02323929-4c3a-4b42-9et0-333fbaeec26e|2022-12-01|36.40704|
+------------------------------------+----------+--------+

-- Invoicing.csv
+------------------------------------+---------------+----------+----------+--------------------------+
|subscription_id                     |calculated_cost|start     |end       |created_at                |
+------------------------------------+---------------+----------+----------+--------------------------+
|02323929-4c3a-4b42-9et0-333fbaeec26e|29.0           |2022-09-01|2022-09-30|2022-10-05 19:32:06.735091|
|02323929-4c3a-4b42-9et0-333fbaeec26e|29.0           |2022-10-01|2022-10-31|2022-11-01 19:37:30.931282|
|02323929-4c3a-4b42-9et0-333fbaeec26e|29.0           |2022-11-01|2022-11-30|2022-11-29 16:43:58.525387|
|02323929-4c3a-4b42-9et0-333fbaeec26e|29.0           |2022-12-01|2022-12-31|2022-12-18 20:53:11.350095|
|02323929-4c3a-4b42-9et0-333fbaeec26e|29.0           |2023-01-01|2023-01-31|2023-01-11 15:43:34.144538|
+------------------------------------+---------------+----------+----------+--------------------------+

-- final table 

SELECT * FROM fct_profitability WHERE subscription_id = '02323929-4c3a-4b42-9et0-333fbaeec26e' ORDER BY month;
+------------------------------------+-------+------------+-----------+-------------------+
|subscription_id                     |month  |sales_amount|cost_amount|profit             |
+------------------------------------+-------+------------+-----------+-------------------+
|02323929-4c3a-4b42-9et0-333fbaeec26e|2022-09|29.0        |39.28128   |-10.281280000000002|
|02323929-4c3a-4b42-9et0-333fbaeec26e|2022-10|29.0        |52.37504   |-23.37504          |
|02323929-4c3a-4b42-9et0-333fbaeec26e|2022-11|29.0        |69.62048   |-40.62048          |
|02323929-4c3a-4b42-9et0-333fbaeec26e|2022-12|29.0        |36.40704   |-7.407040000000002 |
|02323929-4c3a-4b42-9et0-333fbaeec26e|2023-01|29.0        |0.0        |29.0               |
+------------------------------------+-------+------------+-----------+-------------------+

"""
Churn Flag -> Validation
"""

-- CSV RAW DATA 
-- COUNT OF ROWS
+---------+
|total_cnt|
+---------+
|273      |
+---------+

-- DISTINCT STATUS
+-----------------------------+
|status                       |
+-----------------------------+
|SUBSCRIPTION_STATUS_ACTIVATED|
|SUBSCRIPTION_STATUS_PENDING  |
|SUBSCRIPTION_STATUS_CANCELLED|
|SUBSCRIPTION_STATUS_PAUSED   |
+-----------------------------+

-- final table

SELECT count(*) AS is_churned_cnt FROM fct_churn WHERE is_churned = '1'; -- SQLLite 1 means true
+--------------+
|is_churned_cnt|
+--------------+
|22            |
+--------------+

SELECT count(*) AS is_not_churned_cnt FROM fct_churn WHERE is_churned = '0'; -- SQLLite 0 means false
+------------------+
|is_not_churned_cnt|
+------------------+
|251               |
+------------------+
-- Total = 251 + 22 = 273 "We are good."

"""
Some Transformation Validations : tag
"""
SELECT DISTINCT(sale_type) FROM dim_subscription;
+-----------+
|sale_type  |
+-----------+
|SUPPORTSALE|
|DIRECTSALE |
|ONLINESALE |
|PARTNERSALE|
|NULL       |
+-----------+

"""
LATEST COST RECORD FROM COST TABLE
"""

-- RAW 
-- PICKED 1 sample : 0066eba3-et5t-46c3-3t2e-3e69c5216173
+------------------------------------+----------+--------+
|subscription_id                     |month     |Cost    |
+------------------------------------+----------+--------+
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-09-01|53.97184|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-10-01|34.17152|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-10-01|74.2512 |
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-11-01|54.77024|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-12-01|90.85792|
+------------------------------------+----------+--------+

-- Transform CSV 
+------------------------------------+----------+--------+
|subscription_id                     |month     |Cost    |
+------------------------------------+----------+--------+
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-01-09|53.97184|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-01-10|74.2512 | --> PICKED THE LATEST RECORD
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-01-11|54.77024|
|0066eba3-et5t-46c3-3t2e-3e69c5216173|2022-01-12|90.85792|
+------------------------------------+----------+--------+